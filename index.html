<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미국주식 실시간 정보</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- 차트 라이브러리 -->
</head>
<body>
    <h1>미국 주식 검색 및 실시간 정보</h1>
    
    <div>
        <label for="stock-symbol">종목 코드 검색: </label>
        <input type="text" id="stock-symbol" placeholder="AAPL, MSFT 등" />
        <button onclick="searchStock()">검색</button>
    </div>
    
    <div id="stock-info">
        <h2 id="stock-name">종목 이름: </h2>
        <p id="current-price">현재가: </p>
        <p id="price-change">변동폭: </p>
    </div>

    <canvas id="stock-chart" width="400" height="200"></canvas>
    
    <script>
        const apiKey = 'cshgh1hr01qu99bg000gcshgh1hr01qu99bg0010'; // 여기 API 키를 입력하세요.

        // 주식 검색 함수
        async function searchStock() {
            const symbol = document.getElementById('stock-symbol').value;
            if (!symbol) return alert('종목 코드를 입력해주세요.');

            try {
                // 실시간 가격 정보 호출
                const priceResponse = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`);
                const priceData = await priceResponse.json();

                document.getElementById('stock-name').innerText = `종목 코드: ${symbol}`;
                document.getElementById('current-price').innerText = `현재가: ${priceData.c}`;
                document.getElementById('price-change').innerText = `변동폭: ${(priceData.d).toFixed(2)} (${(priceData.dp).toFixed(2)}%)`;

                // 차트 데이터 호출 및 표시
                getStockChartData(symbol);
            } catch (error) {
                console.error('오류 발생:', error);
            }
        }

        // 차트 데이터 함수
        async function getStockChartData(symbol) {
            try {
                const resolution = 'D'; // D: 일별, W: 주별, M: 월별, 1: 1분, 5: 5분 등
                const now = Math.floor(Date.now() / 1000); // 현재 시간 (초 단위)
                const past = now - (365 * 24 * 60 * 60); // 1년 전 시간 (초 단위)

                const chartResponse = await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=${resolution}&from=${past}&to=${now}&token=${apiKey}`);
                const chartData = await chartResponse.json();

                if (chartData.s !== 'ok') throw new Error('차트 데이터를 불러올 수 없습니다.');

                const dates = chartData.t.map(timestamp => new Date(timestamp * 1000).toLocaleDateString());
                const prices = chartData.c;

                // 차트 생성
                renderChart(dates, prices);
            } catch (error) {
                console.error('차트 오류 발생:', error);
            }
        }

        // 차트 렌더링 함수
        function renderChart(dates, prices) {
            const ctx = document.getElementById('stock-chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: '종가',
                        data: prices,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        x: { display: true, title: { display: true, text: '날짜' }},
                        y: { display: true, title: { display: true, text: '가격' }}
                    }
                }
            });
        }
    </script>
</body>
</html>
